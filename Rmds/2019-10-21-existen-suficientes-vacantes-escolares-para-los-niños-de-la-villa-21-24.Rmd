---
title: "쮼xisten suficientes vacantes escolares para los ni침os de la Villa 21-24?"
comments: yes
date: '2019-10-21'
publishdate: '2019-10-21T16:24:37-03:00'
slug: existen-suficientes-vacantes-escolares-para-los-ni침os-de-la-villa-21-24
tags:
- inequidad
- educaci칩n
categories: reporte
---

_Presentamos el an치lisis (a칰n en proceso) desarrollado por [Demian Zayat](https://twitter.com/demzayat), abogado e investigador que se especializa en temas de igualdad y no discriminaci칩n, violencia institucional y discriminaci칩n hacia migrantes._

_Demian trabaja con R desde 2008, cuando hizo su tesis de maestr칤a para la Universidad de Stanford sobre concursos y selecci칩n de jueces. Sin embargo, el inter칠s -luego de varios a침os dormido- reapareci칩 en el 2018 con la ciencia de datos. Arm칩 el sitio www.antidiscriminacion.org y est치 cursando el [posgrado de FLACSO sobre Big Data e Inteligencia Territorial](https://www.flacso.org.ar/formacion-academica/big-data-e-inteligencia-territorial/)._



En mayo de 2011 un grupo de madres de ni침os en edad escolar primaria que habitan en la Villa 21-24, con el patrocinio letrado de la Defensor칤a General Adjunta en lo Contencioso Administrativo y Tributario, interpusieron una acci칩n de amparo contra el Gobierno de la Ciudad de Buenos Aires, en tanto entend칤an que no exist칤an vacantes escolares suficientes para todos los ni침os del barrio.  

Dentro de ese amparo se le solicit칩 al GCBA que hiciera un censo para saber cu치ntos ni침os viv칤an en la Villa 21-24 y que informase la cantidad de vacantes existentes dentro de un radio de 10 cuadras a la redonda, para saber si eran suficientes o no. En caso de que no lo fueran, se le solicit칩 al Gobierno que indicase cu치les eran las medidas que pod칤a adoptar, en el corto y mediano plazo, para revertir esta situaci칩n. 
La jueza orden칩 la realizaci칩n del censo. Sin embargo, diversas reparticiones del Gobierno de la Ciudad empezaron a decir que no eran ellos los encargados de realizarlos: La direcci칩n de Estad칤sticas y Censo dijo que deb칤a ser Educaci칩n, Educaci칩n dijo que deb칤a ser la Unidad de Gesti칩n Intervenci칩n Social (UGIS), y la UGIS dec칤a que deb칤a ser la Direcci칩n de Estad칤sticas y Censos. Frente a este escenario, la jueza orden칩 la realizaci칩n al Gobienro bajo pena de tener por v치lidos los datos que recopilara la Defensor칤a General de la Ciudad.

Desde la Defensor칤a General iniciamos la realizaci칩n de un censo de ni침os en edad escolar. As칤, varios equipos de censistas rastrillaron la villa para ver cu치ntos ni침os viv칤an all칤.  Se pudo censar a algunos ni침os, y proyectar la respuesta para los que no fueron hallados. Al mismo tiempo, se le solicitaron informes al INDEC, para que enviase la informaci칩n que tuvieran disponible. 

Luego de esta informaci칩n se contrast칩 con la cantidad de vacantes que inform칩 el GCBA que hab칤a disponibles en la zona. All칤 la discusi칩n pasaba por saber a qu칠 distancia estaban las escuelas que pod칤an proveer las vacantes, y en caso de estar a m치s de 10 cuadras, ofrecer un servicio de transporte escolar.

Durante el tr치mite de la causa, se cre칩 un sistema de tansporte escolar y se inaugur칩 una escuela en la calle "Los Patos 3042", que provey칩 vacantes para los ni침os del barrio. El caso est치 a칰n en tr치mite, y hay un compromiso de construir dos escuelas m치s en la zona.

En este trabajo pretendo realizar el an치lisis sobre la cantidad de ni침os y de vacantes existentes, para ver si esta relaci칩n es adecuada o no. El objetivo es ver si desde la Ciencia de Datos puede proveerse este tipo de informaci칩n para este o para casos similares a realizar en otros barrios. Si este an치lisis es facilmente replicable, podr치 pensarse en construir esta evidencia antes de recurrir a la Justicia, o en su caso, recurrir a la justicia para contrastarla y discutirla, pero evitando toda la discusi칩n sobre qui칠n har치 el censo.

Para esto, voy a analizar la cantidad de ni침os que viven en la Villa 21-24 de la Ciudad, en edad escolar, partiendo de los microdatos del Censo 2010, asumiendo que esta poblaci칩n es m치s o menos estable a lo largo del tiempo. Luego, analizar칠 cu치ntas escuelas hay en la comuna 4, para filtrar aquellas que est치n en un radio de 10 cuadras a la redonda de la Villa y calcular sus vacantes, de acuerdo a la informaci칩n p칰blcia existente. 

Este trabajo puede ser parte de un proyecto mayor que analice la disponiblidad de bienes y servicios cercanos a los barrios informales de la Ciudad. En concreto aqu칤 analizar칠 vacantes escolares primarias, pero podr칤a pensarse tambi칠n en hacer un estudio comparativo sobre otro tipo de bienes y servicios, como ser칤an clubes deportivos, centros culturales, restaurantes, servicios de salud, etc. 

# Metodolog칤a

La metodolog칤a de este trabajo ser치 el an치lisis de bases de datos p칰blicas estatales y no estatales, y su modelado y visualizaci칩n con el lenguaje R. No hay que olvidar que este es un trabajo pr치ctico para el M칩dulo 3 del posgrado sobre "Big Data e Inteligencia Territorial" que se cursa en FLACSO, Buenos Aires. 

Ir칠 explicando la metodolog칤a que siga para obtener los datos, y el c칩digo respectivo, tanto para el procesamiento como para la visualizaci칩n respectiva.

Los datos muchas veces no est치n disponibles y hay que construirlos. Esto trae mayores complicaciones, pero el desaf칤o es interesante. Por ejemplo, el primer dato que habr치 que contruir es la cantidad de poblaci칩n por barrio informal, lo que suele ser complicado y controversial. Existen datos fidedignos del censo de 2010, pero ya han pasado nueve a침os de dicho censo. Habr치 que ver si este dato sigue siendo v치lido o no. Ser칤a ideal contar con esta informaci칩n por radio censal, o lo m치s desagregada posible. Es importante poder contar con esta informaci칩n desagregada por edad.

Lo segundo que tambi칠n hay que construir es la cantidad de vacantes por escuelas. Esa es informaci칩n podr칤a estar disponible, pero no consta en los repositorios oficiales. Lo qu칠 s칤 est치 disponible son las vacantes asignadas (de modo anonimizado por supuesto) en los a침os 2015, 2016 y 2017. Esos datos podr치n darnos una idea de la cantidad de vacantes que se asignaron por a침o por escuela, por lo que podemos tener una aproximaci칩n razonable a la cantidad de vacantes que hay en cada escuela. 

Y por 칰ltimo habr치 que calcular las distancias de las escuelas al barrio informal donde viven los ni침os. Y ver si esas escuelas tambi칠n ofrecen vacantes a los ni침os de los alrededores del barrio informal.

## Geolocalizaci칩n de los datos del censo 2010

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
```

```{r}
# Paquetes a utilizar:

library(tidyverse)
library(sf)
library(leaflet)
library(kableExtra)
library(mapdeck)
library(widgetframe)
```



Conocer la cantidad de ni침os en edad escolar que viven en los barrios informales no es sencillo. Si bien el GCBA realiza censos en los distintos barrios, en general en cumplimiento de 칩rdenes judiciales, esos datos no son p칰blicos. Por ello, habr치 que recurrir a las fuentes _disponibles_, o al menos a las _existentes_. Esto es, los datos del Censo Nacional 2010.

En primer lugar voy a cargar los datos del censo 2010 de la Ciudad de Buenos Aires, por persona. 

Asimismo, construir칠 la variable `CO_FRAC_RA` por la que voy a unir, en primer lugar el shapefile de los radios censales de la Ciudad, y luego, recortar칠 aquellos radios censales de la Comuna 4 y de los barrios informales de dicha comuna.

```{r include = FALSE}

# Leemos la data del filesystem local
load(file = "../../public/data/radio_persona_caba.rdata") 

radio_persona_caba <- radio_persona_caba %>% 
  filter(IDDPTO == "004") %>% 
  rename("relacion_jefe" = P01,
         "sexo" = P02,
         "edad" = P03,
         "nacimiento" = P05,
         "pais" = P06,
         "lee_escribe" = P07,
         "usa_comput" = P12,
         "escolaridad" = P08,
         "nivel" = P09,
         "completo" = P10,
         "actividad" = CONDACT,
         "material_piso" = H05,
         "material_techo" = H06,
         "revestimientos" = H07)

#creando CO_FRAC_RA, desde las variables DPTO_REF_ID, IDFRAC e IDRADIO, sacandole los ceros de adelante. 
radio_persona_caba <- radio_persona_caba %>% 
  mutate(IDFRAC = as.numeric(IDFRAC),
         IDRADIO = as.numeric(IDRADIO)) %>% 
  unite(CO_FRAC_RA, DPTO_REF_ID, IDFRAC, IDRADIO, sep = "_", remove = FALSE)
```

```{r censo, eval=FALSE}

# Cargamos datos del censo 2010 para la Ciudad Aut칩noma de Buenos Aires.
# son casi 3 millones de registros, va a tomar un rato!

load(file = "https://elradar.github.io/data/radio_persona_caba.rdata")

radio_persona_caba <- radio_persona_caba %>% 
  rename("relacion_jefe" = P01,
         "sexo" = P02,
         "edad" = P03,
         "nacimiento" = P05,
         "pais" = P06,
         "lee_escribe" = P07,
         "usa_comput" = P12,
         "escolaridad" = P08,
         "nivel" = P09,
         "completo" = P10,
         "actividad" = CONDACT,
         "material_piso" = H05,
         "material_techo" = H06,
         "revestimientos" = H07)

#creando CO_FRAC_RA, desde las variables DPTO_REF_ID, IDFRAC e IDRADIO, sacandole los ceros de adelante. 
radio_persona_caba <- radio_persona_caba %>% 
  mutate(IDFRAC = as.numeric(IDFRAC),
         IDRADIO = as.numeric(IDRADIO)) %>% 
  unite(CO_FRAC_RA, DPTO_REF_ID, IDFRAC, IDRADIO, sep = "_", remove = FALSE)
```


Ahora cargo los shapefiles de los radios censales de la Ciudad, para unirlos a los datos del censo de personas.

```{r radios_geo, message=FALSE, warning=FALSE}

#descargo del repositorio de datos abiertos de Ciudad
censo_geo <- st_read ("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/informacion-censal-por-radio/CABA_rc.geojson", quiet = TRUE)

#selecciono la variable que me sirve
censo_geo_radio <- censo_geo %>% 
  select(CO_FRAC_RA = RADIO_ID)

#lo uno al censo de personas
radio_persona_caba <- radio_persona_caba %>% 
  left_join(censo_geo_radio, by = "CO_FRAC_RA")
```

Ahora tenemos los datos del censo de personas, y su radio censal geolocalizado. Con esto vamos a poder clasificar a las personas por edad, para saber qui칠nes asisten o deben asistir a las escuelas primarias. Pero primero comencemos con el piloto de la Comuna 4.

# Analisis de la Villa 21-24

## 쮺u치ntos ni침os en edad escolar hay?

Para saber cu치ntos ni침os en edad escolar hay en el barrio informal Villa 21-24, filtrar칠 los datos del censo de personas por este barrio informal. Para ello, deber칠 identificar los radios censales del barrio y cruzarlo con los datos de los radios censales del Censo 2010. En primer lugar, filtrar칠 los datos del censo para la Comuna 4, y luego lo cruzar칠 con los de la Villa 21-24.

Una vez realizado eso, deber칠 analizar la base de datos de Barrios informales de la Ciudad. En el sitio de la [Plataforma Abierta Nacional del H치bitat] (https://panh.mininterior.gob.ar/#/) se puede buscar informaci칩n sobre los barrios informales de la Ciudad y descargar el [shapefile] (https://panh-backoffice.mininterior.gob.ar/api/relevamientos/28/dataset/caba-datos.zip).

```{r comuna4, message=FALSE}
comuna4_geo <- censo_geo%>% 
  filter(COMUNA == 4) %>% 
  select(RADIO_ID)

barrios <- st_read("https://elradar.github.io/data/barrios_populares.geojson", quiet = TRUE)

comuna4_villa2124 <- barrios %>% 
  filter(FNA == "Villa 21-24") %>% 
  select(FNA)
```

Y hacemos un primer mapa para ver c칩mo vienen los datos de los radios censales de la Villa 21-24 tanto del shapefile de la Plataforma Abierta Nacional del H치bitat, como del shapefile del Censo 2010.

```{r}
ggplot()+
  geom_sf(data = comuna4_geo, fill = NA, col = "grey40")+
  geom_sf(data = comuna4_villa2124, fill = "green")+
  labs(title = "Comuna 4. Radios censales y Asentamientos")+
  theme_minimal()
```

Puede verse que el mapa de los barrios est치 apenas corrido con el de los radios censales. Esto puede deberse a que al ser de distintas fuentes, puede diferir en alguna localizaci칩n, o que se est치n juntando dos proyecciones similares pero sutilmente diferentes^[Sin embargo, al hacer `st_crs(censo_geo) == st_crs(barrios)` la respuesta es `r st_crs(censo_geo) == st_crs(barrios)`.]. 

De este modo, habr치 que hacer una sutil correcci칩n manual del shapefile de los barrios informales, para que quede exacto. Tambi칠n voy a reducir un 1% el tama침o del barrio para que no exceda los l칤mites de los barrios. Veamoslo en el mapa

```{r}
barrios_bis <- st_geometry(barrios)
barrios_bis <- barrios_bis + c(0.00055,-0.0004)
barrios_bis_centroides <- st_centroid(barrios_bis)
barrios_bis <- (barrios_bis - barrios_bis_centroides)*0.99 + barrios_bis_centroides
barrios_bis <- st_sf(barrios_bis, crs = 4326)
barrios$geometry <- st_geometry(barrios_bis)

comuna4_villa2124 <- barrios %>%  #filtro por comuna 4
  filter(FNA == "Villa 21-24") %>% 
  select(FNA)

ggplot()+ #graficamos
  geom_sf(data = comuna4_geo, fill = NA, col = "grey40")+
  geom_sf(data = comuna4_villa2124, fill = "green")+
  labs(title = "Comuna 4. Radios censales y Asentamientos")+
  theme_minimal()
```


춰Mucho mejor! Ahora, vamos a seleccionar ahora los radios censales donde est치 la villa 21-24 del Censo 2010.

```{r villa_2124_radios, message=FALSE}
# funci칩n para detectar en qu칠 radios censales est치 cierto objeto

cuales_radios <- function(x = comuna4_geo, y){
  radios <- st_intersects(x, y)
  radios <- lengths(radios)>0
  cbind(x, radios) %>% 
    filter(radios == TRUE)
}

radios_villa_2124 <- cuales_radios(comuna4_geo, comuna4_villa2124)

ggplot()+
  geom_sf(data = radios_villa_2124, fill = "red")+
  geom_sf(data = comuna4_geo, fill = NA)+
  geom_sf(data = comuna4_villa2124, fill = "green")+
  labs(title = "Comuna 4. Radios censales de la Villa 21-24")+
  theme_minimal()
```

En el mapa, lo verde es la Villa 21-24 y lo rojo son los radios censales seleccionados, donde hay alguna parte de la Villa. La zona roja es un poco m치s amplia que la verde, pero habr치 que ver los datos para ver si esto es preocupante o no. 

Al unir estos radios con el dataset del censo, podemos saber cu치ntas personas viven en los barrios informales, o sus radios censales contiguos. En base a esto, averiguar cu치ntos ni침os requieren una escuela cercana. Habr치 una peque침a sobreestimaci칩n de los datos por los tama침os de los radios censales. 

```{r censo_comuna4, message=FALSE}
radio_persona_caba$CO_FRAC_RA <- factor(radio_persona_caba$CO_FRAC_RA)

villa_2124_censo <- radio_persona_caba %>% 
  filter(CO_FRAC_RA %in% radios_villa_2124$RADIO_ID)
```

Seg칰n este filtrado, en los `r length(table(villa_2124_censo$RADIO_REF_ID))` radios censales viven (o viv칤an al 2010) `r nrow(villa_2124_censo)` personas.  

Este resultado que obtuvimos (al filtrar el censo geolocalizado) es similar al que public칩 la Direcci칩n de Estad칤sticas y Censos de la Ciudad, en el informe de resultados 856 de Abril de 2015 [en el siguiente link](https://estadisticaciudad.gob.ar/eyc/wp-content/uploads/2015/05/ir_2015_856.pdf). Para la Villa 21-24 y el NHT Zavaleta^[Si bien son dos centros diferenciados por cuestiones hist칩ricas, est치n contig칲os geogr치ficamente, y comparten radios censales, por lo que tambi칠n qued칩 incluido en mi an치lisis], el documento oficial informa 33.245, un n칰mero muy similar al de `r nrow(villa_2124_censo)` que obtuve. La diferencia puede deberse al radio censal superior, que si bien est치 pr치cticamente despoblado (existen en dicho lugar v칤as de tren, dep칩sitos ferroviarios y fiscales, junto al estadio del club Hurac치n) puede ser que incluya a las `r nrow(villa_2124_censo) - 33245` personas de diferencia. A falta de mejores datos, vamos a asumir que esos valores son actuales. Esta congruencia de datos nos permite validar la asunci칩n de que la poblaci칩n de este barrio es relativamente estable en el tiempo, ya que entre 2010 y 2015 no hubo variaciones significativas.

Y ahora s칤, con estos datos, podemos estimar cu치ntos ni침os en edad escolar primaria existen. Para ello deberemos filtrar los ni침os entre 6 y 12 a침os de edad, ambos inclusive. 

Como modo de control, podemos filtrar tambi칠n por el campo `P09` que he renombrado como `nivel` que indica el nivel educativo que cursa o curs칩, junto con la variable `P08` que renombre  `escolaridad` e indica _condici칩n de asistencia escolar_, pudiendo seleccionar s칩lo aquellos que son de valor `1`, es decir, que `asiste` a ese nivel.

```{r edad_escolar}
edad_escolar <- villa_2124_censo %>% 
  filter(edad >= 6 & edad <= 12)

nivel_primario <- villa_2124_censo %>% 
  filter(nivel == 2 & escolaridad == 1)

edad_noasiste <- edad_escolar %>% 
  filter(escolaridad == 2 | escolaridad == 3) %>% 
  filter(completo == 2| completo == 0)

repitencia <- nivel_primario %>% 
  filter(edad > 13 & edad <= 18) 

```

Seg칰n los datos del Censo 2010, en la Villa 21-24 habitan `r nrow(edad_escolar)` ni침os en edad escolar primaria. Sin embargo, contestaron que asisten al nivel primario `r nrow(nivel_primario)` personas, por lo que puede observarse que muchas personas cursan el nivel primario luego de la edad establecida. Tambi칠n pudimos filtrar cu치ntos ni침os en edad escolar no asisten a la primaria, lo que no da un total de `r nrow(edad_noasiste)`, ya sea porque abandonaron (`r nrow(edad_escolar %>% filter(escolaridad == 2))` personas) o porque nunca lo iniciaron (`r nrow(edad_escolar %>% filter(escolaridad == 3))` personas).

De este modo, el total de ni침os en edad escolar que requieren vacantes en escuelas de la Ciudad es de `r nrow(edad_escolar)` ni침os.

## 쮺u치ntas vacantes escolares hay?

Ahora habr치 que sumar las escuelas y sus vacantes, para ver si son suficientes para los `r nrow(edad_escolar)` ni침os de la Villa 21-24.

Para ello descargamos el shapefile del repositorio oficial del GCBA y filtramos las escuelas p칰blicas y primarias. Luego las proyectaremos en el mapa y seleccionaremos aquellas a una distancia razonable de los radios censales del barrio informal seleccionado.

Tambi칠n ser치 necesario calcular cu치ntas vacantes hay en cada escuela. Esto no est치 disponible facilmente, pero podr치 calcularse en raz칩n de  las inscripciones realizadas por escuela, lo que s칤 est치 disponible en el [repositorio](https://data.buenosaires.gob.ar/dataset/inscripcion-escolar/archivo/123.3). 

De ese repositorio pude descargar las inscripciones para primer grado de los a침os 2016 y 2017. C칩mo son similares, pero no id칠nticos, sacar칠 el promedio y multiplicar칠 por siete para saber la cantidad total de vacantes por escuela.


```{r vacantes, message = FALSE}
#Escuelas Geo
escuelas <-  read_csv("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/establecimientos-educativos/establecimientos-educativos.csv") %>% st_as_sf(coords = c("long", "lat"), crs = 4326) 

primarios <- escuelas %>% 
  filter(nivmod == "PriCom") %>% 
  mutate(cueanexo = as.numeric(as.character(cueanexo)))

#Escuelas vacantes
vacantes17 <- read_csv2("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/inscripcion-escolar/preinscripciones-escolares-2017.csv", locale = locale(encoding = "latin1") ) %>% 
  filter(NIVEL == "PRIMARIO") %>% 
  group_by(ESTABLECIMIENTO, CUE_ANEXO) %>% 
  summarise(primero_17 = n())

vacantes16 <- read_csv2("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/inscripcion-escolar/inscripciones-escolares-2016.csv", locale = locale(encoding = "UTF-8") )%>% 
  filter(NIVEL == "PRIMARIO") %>% 
  group_by(ESTABLECIMIENTO) %>% 
  summarise(primero_16 = n())  


vacantes_prom <- vacantes17 %>% 
  bind_cols(., vacantes16) %>% 
  select(-ESTABLECIMIENTO1) %>% 
  mutate(total = round((primero_17+primero_16)/2*7,0)) %>% 
  ungroup() %>% 
  select(-primero_17, -primero_16, -ESTABLECIMIENTO)

primarios_vacantes <- primarios %>% 
  left_join(vacantes_prom, by = c("cueanexo" = "CUE_ANEXO")) %>% 
  select(cueanexo, dom_edific, nombre_abrev, de, comunas, total)
```

Y graficamos los de la COMUNA 4 en un mapa interactivo, con el centro en el l칤mite de la Villa 21-24. Cuando pasamos el puntero vemos el nombre de la escuela y la cantidad de vacantes.

```{r}
primarios_comuna_4 <- primarios_vacantes %>% 
    mutate(long = st_coordinates(primarios_vacantes)[,1],
           lat = st_coordinates(primarios_vacantes)[,2]) %>% 
    filter(comunas == 4)

mapa_escuelas <- leaflet() %>% 
    setView(lng =-58.399685,lat = -34.654402, zoom = 13) %>% 
    addTiles() %>% 
    addPolygons(data = st_union(comuna4_geo)) %>% 
    addPolygons(data = st_union(comuna4_villa2124), color = "red") %>% 
    addMarkers(data = primarios_comuna_4,
               lng = primarios_comuna_4$long,
               lat = primarios_comuna_4$lat,
               label = ~paste0(primarios_comuna_4$NOMBRE_ABR, ": ",as.character(primarios_comuna_4$total)) )

```

```{r eval=FALSE, echo=FALSE}
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/demian_mapa_escuelas.html")
```

```{r eval=FALSE}
mapa_escuelas
```

<iframe height=400 width=1200 src='/widgets/demian_mapa_escuelas.html'> </iframe>

Para ver qu칠 escuelas est치n dentro del radio de diez cuadras de la villa  --que es la distancia para obtener prioridad en la inscripci칩n, de acuerdo al art칤culo 29 del Reglamento de inscripciones^[V칠ase en l칤nea el [reglamento](http://www.ademys.org.ar/v2/wp-content/uploads/2015/10/Reglamento-del-Sistema-de-Inscripciones-y-Asignaci%C3%B3n-de-Vacantes.pdf).]-- podemos ampliar el per칤metro de la villa con un `st_buffer` y graficarlo.


```{r}
comuna4_villa2124_buffer<- comuna4_villa2124 %>% 
  st_buffer(.,0.007) 

escuelas_buffer <- leaflet() %>% 
    setView(lng =-58.399685,lat = -34.654402, zoom = 13) %>% 
    addTiles() %>% 
    addPolygons(data = comuna4_villa2124_buffer, color = "green") %>% 
    addPolygons(data = st_union(comuna4_geo)) %>% 
    addPolygons(data = st_union(comuna4_villa2124), color = "red") %>% 
    addMarkers(data = primarios_comuna_4,
               lng = primarios_comuna_4$long,
               lat = primarios_comuna_4$lat,
               label = ~paste0(primarios_comuna_4$NOMBRE_ABR, ": ",as.character(primarios_comuna_4$total)) )

```

```{r eval=FALSE, echo=FALSE}
htmlwidgets::saveWidget(escuelas_buffer, file = "../../public/widgets/demian_escuelas_buffer.html")
```


```{r eval=FALSE}
escuelas_buffer
```

<iframe height=400 width=1200 src='/widgets/demian_escuelas_buffer.html'> </iframe>


Ahora podemos identificar las escuelas que est치n en el radio de 10 cuadras, que pueden darle vacantes a los ni침os de la Villa 21-24, y calcular su cantidad de vacantes.

```{r escuelas_villa}
escuelas_villa <- st_intersects(primarios_vacantes, comuna4_villa2124_buffer, sparse = FALSE) 

escuelas_villa <- data.frame(escuelas_villa) %>% 
    rename(villa = escuelas_villa)

primarias_villa <-cbind(primarios_vacantes, escuelas_villa$villa) %>% 
    rename(villa = escuelas_villa.villa)

primarias_villa <- primarias_villa %>% 
    filter(villa == TRUE)

primarias_villa <- primarias_villa %>% 
    mutate ( distancia = st_distance(primarias_villa, st_centroid(comuna4_villa2124)) ) %>% 
    select(-cueanexo, -de, -comunas, villa)

```

De este modo, hay `r nrow(primarias_villa)` escuelas que est치n dentro de un radio menor a 10 cuadras del centro de la villa que pueden ofrecer vacantes para estos ni침os. Ellas son las siguientes:

```{r}
primarias_villa %>% 
  st_set_geometry(NULL) %>% 
  select(-villa) %>% 
  kable() %>% 
  kable_styling(bootstrap_options = "striped", full_width = F)
```

Si estas escuelas s칩lo le dan vacantes a los ni침os de la villa 21-24, habr칤a un total de `r sum(primarias_villa$total)` vacantes, para los `r nrow(edad_escolar)` ni침os. Sin embargo, no hay que dejar de tener en cuenta que hay otros ni침os en los alrededores de la Villa 21-24 que tambi칠n requieren vacantes escolares. 

Podemos calcular cu치ntos ni침os hay en esos radios censales, del mismo modo que lo hicimos con los ni침os de la villa 21-24.

```{r}
alrededores <- cuales_radios(comuna4_geo, comuna4_villa2124_buffer)

alrededores_censo <- radio_persona_caba %>% 
  filter(CO_FRAC_RA %in% alrededores$RADIO_ID)

alrededores_edad_escolar <- alrededores_censo %>% 
  filter(edad >= 6 & edad <= 12)
```


Cuando sumamos los alrededores, vemos que la cantidad de vacantes es sensiblemente inferior a la requerida. As칤, las `r nrow(primarias_villa)` escuelas cercanas a la Villa 21-24, con sus `r sum(primarias_villa$total)`, vacantes,  deben proveerle educaci칩n primaria a `r nrow(alrededores_edad_escolar)`, lo que es llamativamente insuficiente.

Es cierto que, como vimos en el mapa interactivo anterior, hay m치s escuelas disponibles en _los alrededores_ de _los alrededores de la villa_, y esto nos podr칤a llevar a un loop. Podr칤a ser que en la Comuna (o en realidad en el Distrito Escolar, que es la unidad territorial para las escuelas) en total haya vacantes disponibles para todos los ni침os del lugar. Pero no es poco importante c칩mo estan distribuidas las vacantes, que es lo que quer칤amos analizar, sobre si las escuelas dentro o cercanas a la Villa 21-24 tiene vacantes para todos los ni침os de la zona. 

## 쯃as escuelas est치n realmente a 10 cuadras de la villa?

Por 칰ltimo, deber칤amos ver si estas escuelas est치n realemente a 10 cuadras de la villa o si el calculo de la distancia lineal es menor que el trayecto realizado por cuadras. 

En primer lugar, habr치 que aclarar que la distancia la medimos desde el centroide de la Villa, que estimamos como promedio de la vivienda de cada ni침o. De este modo, habra algunos ni침os m치s cerca y otros m치s lejos que lo medido.

En segundo lugar habr치 que calcular los recorridos, y ello a칰n no lo s칠 hacer (游뗻). Pero s칤 puedo calcular c칩mo ser칤a el arco....

```{r, include= FALSE}
key <- "pk.eyJ1IjoiZGVtb24wMiIsImEiOiJjazBhNGFndGUwZnVtM21tZ3p4cDhiaGluIn0.sOhJPJOn1l_VbN0g_gK8AQ"
```

```{r eval=FALSE}
key <- "API key de Mapbox aqui" # ver https://docs.mapbox.com/help/how-mapbox-works/access-tokens/
mapdeck(token = key)
```


```{r}
caminos <- primarias_villa %>% 
    mutate(lon_salida = st_coordinates(st_centroid(comuna4_villa2124))[1],
           lat_salida = st_coordinates(st_centroid(comuna4_villa2124))[2])

caminos <- caminos %>% 
    mutate(lon_llegada = st_coordinates(caminos)[,1],
           lat_llegada = st_coordinates(primarias_villa)[,2]) %>% 
    st_set_geometry(NULL)

escuelas_arcos <- mapdeck(style = mapdeck_style("streets"),
        location = c(-58.399685, -34.654402), zoom = 10, token = key, pitch = 60) %>% 
    add_arc(data = caminos,
             layer_id = "caminos_escuelas",
             destination = c("lon_salida", "lat_salida"),
             origin  = c("lon_llegada", "lat_llegada")) %>% 
    add_polygon(data = comuna4_villa2124)
```

```{r eval=FALSE, echo=FALSE}
htmlwidgets::saveWidget(escuelas_arcos, file = "../../public/widgets/demian_escuelas_arcos.html")
```

```{r eval=FALSE}
escuelas_arcos
```

<iframe height=400 width=1200 src='/widgets/demian_escuelas_arcos.html'> </iframe>


# Conclusiones

Con este ejercicio pudimos ver qu칠 es facilmente calculable si la cantidad de vacantes escolares es suficiente o no para cierto barrio informal. Primero filtramos el shapefile del barrio informal con los radios censales del censo 2010 para identificar en qu칠 radios est치 ubicado. Con ello, filtramos la cantidad de ni침os en edad escolar que hay en esos radios censales.

Luego buscamos qu칠 escuelas est치n a un radio de 10 cuadras a la redonda del barrio. Y calculamos sus vacantes, de acuerdo a la cantidad de inscripciones que tuvo en los 칰ltimos a침os para primer grado. Y luego calculamos a qu칠 distancia est치n. Despues podremos calcular trayectorias (cuando aprenda a hacerlo).

Con estos pasos podemos pensar en ampliar el trabajo a otros barrios informales, y tambi칠n podremos utilizar los datos del censo 2020 cuando est칠n disponibles. Creo que este tipo de metodolog칤a puede ser util para mapear necesidades de los barrios informales y pensar pol칤ticas p칰blicas que podr치 adoptar por s칤 el gobierno, o que podr치 solicitarselo a la Justicia si no se cumplen.

El c칩digo de este Rmarkdown est치 disponible [aca](https://raw.githubusercontent.com/Demzayat/varios/master/Modulo%203/trabajopractico.Rmd).




