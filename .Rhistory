filter(DECCFR %in% c(1:10)) %>%
group_by(DECCFR) %>%
mutate(Pob = sum(PONDIH)) %>%
group_by(DECCFR, Sexo) %>%
summarise(Prop = sum(PONDIH)/unique(Pob))
ggplot(tabla13.1_graf, aes(x = DECCFR, Prop, fill = Sexo, group= Sexo, label = paste0(formato_porc(Prop*100), "%"))) +
geom_col(position = "dodge") +
geom_text(position = position_dodge(width = .9), vjust =-.1, size = 2.5) +
theme_minimal() +
theme(axis.text.y = element_blank(),
axis.ticks.y = element_blank()) +
labs(y = '') +
scale_fill_manual(values = colores) +
scale_x_continuous("Decil del Ingreso Per Cápita Familiar", breaks = c(1:10)) +
labs(caption = "Fuente: Elaboración propia en base a EPH-INDEC")
tabla12.1_graf <-base_individual %>%
select(DECINDR, P47T, PONDII, Sexo) %>%
filter(DECINDR %in% c(1:10)) %>%
group_by(DECINDR) %>%
mutate(Pob = sum(PONDII)) %>%
group_by(DECINDR, Sexo) %>%
summarise(Prop = sum(PONDII)/unique(Pob))
ggplot(tabla12.1_graf, aes(x = DECINDR, Prop, fill = Sexo, group= Sexo, label = paste0(formato_porc(Prop*100), "%"))) +
geom_col(position = "dodge")+
geom_text(position = position_dodge(width = .9), vjust =-.1, size = 2.5)+
theme_minimal()+
theme(axis.text.y = element_blank(),
axis.ticks.y = element_blank()) +
labs(y = '') +
scale_fill_manual(values = colores)+
scale_x_continuous("Decil de ingreso total", breaks =c(1:10)) +
labs(caption = "Fuente: Elaboración propia en base a EPH-INDEC")
blogdown:::serve_site()
servr::daemon_stop(1)
blogdown::install_hugo()
blogdown::install_hugo(force = TRUE)
blogdown:::serve_site()
blogdown:::serve_site()
blogdown::install_theme()
blogdown::install_theme("jane")
blogdown::install_theme("xianmin/hugo-theme-jane")
blogdown::install_theme("panr/hugo-theme-terminal/")
blogdown::install_theme("panr/hugo-theme-terminal")
blogdown::install_theme("panr/hugo-theme-terminal", force = TRUE)
blogdown::install_theme("vjeantet/hugo-theme-casper")
blogdown::install_theme("nodejh/hugo-theme-cactus-plus")
blogdown::install_theme("vjeantet/hugo-theme-casper", force = TRUE)
blogdown::install_theme("panr/hugo-theme-terminal", force = TRUE)
blogdown::install_theme("nodejh/hugo-theme-cactus-plus", force = TRUE)
blogdown::install_theme("jbub/ghostwriter")
blogdown::install_theme("nodejh/hugo-theme-cactus-plus", force = TRUE)
blogdown::install_theme("frjo/hugo-theme-zen")
blogdown:::new_post_addin()
blogdown::install_theme("JugglerX/hugo-whisper-theme")
blogdown::install_theme("allnightgrocery/hugo-theme-blueberry-detox")
blogdown::install_theme("lgaida/mediumish-gohugo-theme")
blogdown:::serve_site()
library(tidyverse)
library(janitor)
datos_originales <- read.csv("https://elradar.github.io/data/data_janitor.csv")
datos_limpios <- datos_originales %>%
clean_names()
datos_originales <- read.csv("https://elradar.github.io/data/data_janitor.csv", fileEncoding="latin1")
datos_limpios <- datos_originales %>%
clean_names()
colnames(datos_limpios)
datos_originales <- read.csv("https://elradar.github.io/data/data_janitor.csv", fileEncoding="latin1")
datos_originales
blogdown:::serve_site()
datos_originales <- read.csv("https://elradar.github.io/data/data_janitor.csv")
datos_originales <- read.csv("https://elradar.github.io/data/data_janitor.csv", encoding = "latin1")
datos_originales
library(tidyverse)
library(janitor)
datos_originales <- read.csv("https://elradar.github.io/data/data_janitor.csv", encoding = "latin1")
datos_originales
datos_limpios <- datos_originales %>%
clean_names()
colnames(datos_limpios)
datos_limpios <- datos_originales %>%
clean_names() %>%
remove_empty("rows") %>%
remove_constant() %>%
convert_to_NA("factor")
duplicados <- datos_limpios %>%
get_dupes()
dim(datos_limpios)
dim(duplicados)
datos_limpios <- datos_limpios %>%
mutate(genero = recode(genero,
"A" = "hombre",
"B" = "mujer"),
apoyo_espiritual = recode(apoyo_espiritual,
"A" = "no quiso",
"B" = "tuvo apoyo")) %>%
mutate_all(na_if,"")
head(datos_limpios)
datos_limpios %>%
tabyl(genero, apoyo_espiritual)
datos_limpios %>%
tabyl(genero, apoyo_espiritual) %>%
adorn_totals("row") %>%   ##muestra el total por categoria de columna
adorn_percentages("row") %>% ##nos muestra las celdas en porcentajes
adorn_pct_formatting() %>% ##formatea el porcentaje de manera legible
adorn_ns() %>% ##le suma a cada celda el número de casos absolutos entre paréntesis
adorn_title() ##le suma el título del cruce en la esquina superior izquierda
blogdown:::serve_site()
library(tidyverse)
library(sf)
load(file = "../../public/data/radio_persona_caba.rdata")
radio_persona_caba <- radio_persona_caba %>%
rename("relacion_jefe" = P01,
"sexo" = P02,
"edad" = P03,
"nacimiento" = P05,
"pais" = P06,
"lee_escribe" = P07,
"usa_comput" = P12,
"escolaridad" = P08,
"nivel" = P09,
"completo" = P10,
"actividad" = CONDACT,
"material_piso" = H05,
"material_techo" = H06,
"revestimientos" = H07)
#creando CO_FRAC_RA, desde las variables DPTO_REF_ID, IDFRAC e IDRADIO, sacandole los ceros de adelante.
radio_persona_caba <- radio_persona_caba %>%
mutate(IDFRAC = as.numeric(IDFRAC),
IDRADIO = as.numeric(IDRADIO)) %>%
unite(CO_FRAC_RA, DPTO_REF_ID, IDFRAC, IDRADIO, sep = "_", remove = FALSE)
#descargo del repositorio de datos abiertos de Ciudad
censo_geo <- st_read ("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/informacion-censal-por-radio/CABA_rc.geojson", quiet = TRUE)
#selecciono la variable que me sirve
censo_geo_radio <- censo_geo %>%
select(CO_FRAC_RA = RADIO_ID)
#lo uno al censo de personas
radio_persona_caba <- radio_persona_caba %>%
left_join(censo_geo_radio, by = "CO_FRAC_RA")
comuna4_geo <- censo_geo%>%
filter(COMUNA == 4) %>%
select(RADIO_ID)
barrios <- st_read(dsn = "/Users/demian/Downloads/CABA Datos",
layer = "CABA_GA_WGS84", quiet = TRUE)
barrios <- st_read("/tmp/CABA Datos/CABA_GA_WGS84.shp")
View(barrios)
st_write(barrios, "public/data/barrios_populares.geojson")
barrios <- st_read("https://elradar.github.io/data/barrios_populares.geojson", quiet = TRUE)
comuna4_villa2124 <- barrios %>%
filter(FNA == "Villa 21-24") %>%
select(FNA)
ggplot()+
geom_sf(data = comuna4_geo, fill = NA, col = "grey40")+
geom_sf(data = comuna4_villa2124, fill = "green")+
labs(title = "Comuna 4. Radios censales y Asentamientos")+
theme_minimal()
barrios_bis <- st_geometry(barrios)
barrios_bis <- barrios_bis + c(0.00055,-0.0004)
barrios_bis_centroides <- st_centroid(barrios_bis)
barrios_bis <- (barrios_bis - barrios_bis_centroides)*0.99 + barrios_bis_centroides
barrios_bis <- st_sf(barrios_bis, crs = 4326)
barrios$geometry <- st_geometry(barrios_bis)
comuna4_villa2124 <- barrios %>%  #filtro por comuna 4
filter(FNA == "Villa 21-24") %>%
select(FNA)
ggplot()+ #graficamos
geom_sf(data = comuna4_geo, fill = NA, col = "grey40")+
geom_sf(data = comuna4_villa2124, fill = "green")+
labs(title = "Comuna 4. Radios censales y Asentamientos")+
theme_minimal()
cuales_radios <- function(x = comuna4_geo, y){
radios <- st_intersects(x, y)
radios <- lengths(radios)>0
cbind(x, radios) %>%
filter(radios == TRUE)
}
radios_villa_2124 <- cuales_radios(comuna4_geo, comuna4_villa2124)
ggplot()+
geom_sf(data = radios_villa_2124, fill = "red")+
geom_sf(data = comuna4_geo, fill = NA)+
geom_sf(data = comuna4_villa2124, fill = "green")+
labs(title = "Comuna 4. Radios censales de la Villa 21-24")+
theme_minimal()
radio_persona_caba$CO_FRAC_RA <- factor(radio_persona_caba$CO_FRAC_RA)
villa_2124_censo <- radio_persona_caba %>%
filter(CO_FRAC_RA %in% radios_villa_2124$RADIO_ID)
edad_escolar <- villa_2124_censo %>%
filter(edad >= 6 & edad <= 12)
edad_escolar <- villa_2124_censo %>%
filter(edad >= 6 & edad <= 12)
nivel_primario <- villa_2124_censo %>%
filter(nivel == 2 & escolaridad == 1)
nivel_primario <- villa_2124_censo %>%
filter(nivel == 2 & escolaridad == 1)
edad_noasiste <-   edad_escolar %>%
filter(escolaridad == 2 | escolaridad == 3) %>%
filter(completo == 2| completo == 0)
repitencia <- nivel_primario %>%
filter(edad > 13 & edad <= 18)
escuelas <-  st_read("/tmp/establecimientos-educativos.shp"
)
st_write(escuelas, "public/data/establecimientos_educativos.geojson")
#Escuelas Geo
escuelas <-  st_read("https://elradar.github.io/data/establecimientos_educativos.shp", quiet = TRUE) %>%
st_transform(4326)
#Escuelas Geo
escuelas <-  st_read("https://elradar.github.io/data/establecimientos_educativos.geojson", quiet = TRUE) %>%
st_transform(4326)
escuelas
primarios <- escuelas %>%
filter(NIVMOD == "PriCom") %>%
mutate(CUEANEXO = as.numeric(as.character(CUEANEXO)))
#Escuelas vacantes
vacantes17 <- read_csv2("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/inscripcion-escolar/preinscripciones-escolares-2017.csv", locale = locale(encoding = "latin1") ) %>%
filter(NIVEL == "PRIMARIO") %>%
group_by(ESTABLECIMIENTO, CUE_ANEXO) %>%
summarise(primero_17 = n())
#Escuelas vacantes
vacantes17 <- read_csv2("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/inscripcion-escolar/preinscripciones-escolares-2017.csv", locale = locale(encoding = "latin1") ) %>%
filter(NIVEL == "PRIMARIO") %>%
group_by(ESTABLECIMIENTO, CUE_ANEXO) %>%
summarise(primero_17 = n())
vacantes16 <- read_csv2("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/inscripcion-escolar/inscripciones-escolares-2016.csv", locale = locale(encoding = "UTF-8") )%>%
filter(NIVEL == "PRIMARIO") %>%
group_by(ESTABLECIMIENTO) %>%
summarise(primero_16 = n())
vacantes16
vacantes_prom <- vacantes17 %>%
bind_cols(., vacantes16) %>%
select(-ESTABLECIMIENTO1) %>%
mutate(total = round((primero_17+primero_16)/2*7,0)) %>%
ungroup() %>%
select(-primero_17, -primero_16, -ESTABLECIMIENTO)
primarios_vacantes <- primarios %>%
left_join(vacantes_prom, by = c("CUEANEXO" = "CUE_ANEXO")) %>%
select(CUEANEXO, DOM_EDIFIC, NOMBRE_ABR, DE, COMUNA, total)
primarios_comuna_4 <- primarios_vacantes %>%
mutate(long = st_coordinates(primarios_vacantes)[,1],
lat = st_coordinates(primarios_vacantes)[,2]) %>%
filter(COMUNA== 4)
mapa_escuelas <- leaflet() %>%
setView(lng =-58.399685,lat = -34.654402, zoom = 13) %>%
addTiles() %>%
addPolygons(data = st_union(comuna4_geo)) %>%
addPolygons(data = st_union(comuna4_villa2124), color = "red") %>%
addMarkers(data = primarios_comuna_4,
lng = primarios_comuna_4$long,
lat = primarios_comuna_4$lat,
label = ~paste0(primarios_comuna_4$NOMBRE_ABR, ": ",as.character(primarios_comuna_4$total)) )
install.packages("mapdeck")
mapa_escuelas
library(leaflet)
mapa_escuelas <- leaflet() %>%
setView(lng =-58.399685,lat = -34.654402, zoom = 13) %>%
addTiles() %>%
addPolygons(data = st_union(comuna4_geo)) %>%
addPolygons(data = st_union(comuna4_villa2124), color = "red") %>%
addMarkers(data = primarios_comuna_4,
lng = primarios_comuna_4$long,
lat = primarios_comuna_4$lat,
label = ~paste0(primarios_comuna_4$NOMBRE_ABR, ": ",as.character(primarios_comuna_4$total)) )
mapa_escuelas <- leaflet() %>%
setView(lng =-58.399685,lat = -34.654402, zoom = 13) %>%
addTiles() %>%
addPolygons(data = st_union(comuna4_geo)) %>%
addPolygons(data = st_union(comuna4_villa2124), color = "red") %>%
addMarkers(data = primarios_comuna_4,
lng = primarios_comuna_4$long,
lat = primarios_comuna_4$lat,
label = ~paste0(primarios_comuna_4$NOMBRE_ABR, ": ",as.character(primarios_comuna_4$total)) )
mapa_escuelas
comuna4_villa2124_buffer<- comuna4_villa2124 %>%
st_buffer(.,0.007)
escuelas_buffer <- leaflet() %>%
setView(lng =-58.399685,lat = -34.654402, zoom = 13) %>%
addTiles() %>%
addPolygons(data = comuna4_villa2124_buffer, color = "green") %>%
addPolygons(data = st_union(comuna4_geo)) %>%
addPolygons(data = st_union(comuna4_villa2124), color = "red") %>%
addMarkers(data = primarios_comuna_4,
lng = primarios_comuna_4$long,
lat = primarios_comuna_4$lat,
label = ~paste0(primarios_comuna_4$NOMBRE_ABR, ": ",as.character(primarios_comuna_4$total)) )
htmlwidgets::saveWidget(escuelas_buffer, file = "escuelas_buffer.html")
rm(radio_persona_caba)
gc()
escuelas_buffer <- leaflet() %>%
setView(lng =-58.399685,lat = -34.654402, zoom = 13) %>%
addTiles() %>%
addPolygons(data = comuna4_villa2124_buffer, color = "green") %>%
addPolygons(data = st_union(comuna4_geo)) %>%
addPolygons(data = st_union(comuna4_villa2124), color = "red") %>%
addMarkers(data = primarios_comuna_4,
lng = primarios_comuna_4$long,
lat = primarios_comuna_4$lat,
label = ~paste0(primarios_comuna_4$NOMBRE_ABR, ": ",as.character(primarios_comuna_4$total)) )
escuelas_buffer
escuelas_villa <- st_intersects(primarios_vacantes, comuna4_villa2124_buffer, sparse = FALSE)
escuelas_villa <- data.frame(escuelas_villa) %>%
rename(villa = escuelas_villa)
primarias_villa <-cbind(primarios_vacantes, escuelas_villa$villa) %>%
rename(villa = escuelas_villa.villa)
primarias_villa <- primarias_villa %>%
filter(villa == TRUE)
primarias_villa <- primarias_villa %>%
mutate ( distancia = st_distance(primarias_villa, st_centroid(comuna4_villa2124)) ) %>%
select(-CUEANEXO, -DE, -COMUNA, villa)
primarias_villa %>%
st_set_geometry(NULL) %>%
select(-villa) %>%
kable() %>%
kable_styling(bootstrap_options = "striped", full_width = F)
library(kableExtra)
primarias_villa %>%
st_set_geometry(NULL) %>%
select(-villa) %>%
kable() %>%
kable_styling(bootstrap_options = "striped", full_width = F)
alrededores <- cuales_radios(comuna4_geo, comuna4_villa2124_buffer)
alrededores_censo <- radio_persona_caba %>%
filter(CO_FRAC_RA %in% alrededores$RADIO_ID)
install.packages("mapdeck")
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
library(widgetframe)
# Paquetes a utilizar:
library(tidyverse)
library(sf)
library(leaflet)
library(kableExtra)
library(mapdeck)
library(widgetframe)
# Leemos la data del filesystem local
load(file = "../../public/data/radio_persona_caba.rdata")
radio_persona_caba <- radio_persona_caba %>%
filter(IDDPTO == "004") %>%
rename("relacion_jefe" = P01,
"sexo" = P02,
"edad" = P03,
"nacimiento" = P05,
"pais" = P06,
"lee_escribe" = P07,
"usa_comput" = P12,
"escolaridad" = P08,
"nivel" = P09,
"completo" = P10,
"actividad" = CONDACT,
"material_piso" = H05,
"material_techo" = H06,
"revestimientos" = H07)
#creando CO_FRAC_RA, desde las variables DPTO_REF_ID, IDFRAC e IDRADIO, sacandole los ceros de adelante.
radio_persona_caba <- radio_persona_caba %>%
mutate(IDFRAC = as.numeric(IDFRAC),
IDRADIO = as.numeric(IDRADIO)) %>%
unite(CO_FRAC_RA, DPTO_REF_ID, IDFRAC, IDRADIO, sep = "_", remove = FALSE)
#descargo del repositorio de datos abiertos de Ciudad
censo_geo <- st_read ("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/informacion-censal-por-radio/CABA_rc.geojson", quiet = TRUE)
#selecciono la variable que me sirve
censo_geo_radio <- censo_geo %>%
select(CO_FRAC_RA = RADIO_ID)
#lo uno al censo de personas
radio_persona_caba <- radio_persona_caba %>%
left_join(censo_geo_radio, by = "CO_FRAC_RA")
comuna4_geo <- censo_geo%>%
filter(COMUNA == 4) %>%
select(RADIO_ID)
barrios <- st_read("https://elradar.github.io/data/barrios_populares.geojson", quiet = TRUE)
comuna4_villa2124 <- barrios %>%
filter(FNA == "Villa 21-24") %>%
select(FNA)
ggplot()+
geom_sf(data = comuna4_geo, fill = NA, col = "grey40")+
geom_sf(data = comuna4_villa2124, fill = "green")+
labs(title = "Comuna 4. Radios censales y Asentamientos")+
theme_minimal()
barrios_bis <- st_geometry(barrios)
barrios_bis <- barrios_bis + c(0.00055,-0.0004)
barrios_bis_centroides <- st_centroid(barrios_bis)
barrios_bis <- (barrios_bis - barrios_bis_centroides)*0.99 + barrios_bis_centroides
barrios_bis <- st_sf(barrios_bis, crs = 4326)
barrios$geometry <- st_geometry(barrios_bis)
comuna4_villa2124 <- barrios %>%  #filtro por comuna 4
filter(FNA == "Villa 21-24") %>%
select(FNA)
ggplot()+ #graficamos
geom_sf(data = comuna4_geo, fill = NA, col = "grey40")+
geom_sf(data = comuna4_villa2124, fill = "green")+
labs(title = "Comuna 4. Radios censales y Asentamientos")+
theme_minimal()
# función para detectar en qué radios censales está cierto objeto
cuales_radios <- function(x = comuna4_geo, y){
radios <- st_intersects(x, y)
radios <- lengths(radios)>0
cbind(x, radios) %>%
filter(radios == TRUE)
}
radios_villa_2124 <- cuales_radios(comuna4_geo, comuna4_villa2124)
ggplot()+
geom_sf(data = radios_villa_2124, fill = "red")+
geom_sf(data = comuna4_geo, fill = NA)+
geom_sf(data = comuna4_villa2124, fill = "green")+
labs(title = "Comuna 4. Radios censales de la Villa 21-24")+
theme_minimal()
radio_persona_caba$CO_FRAC_RA <- factor(radio_persona_caba$CO_FRAC_RA)
villa_2124_censo <- radio_persona_caba %>%
filter(CO_FRAC_RA %in% radios_villa_2124$RADIO_ID)
edad_escolar <- villa_2124_censo %>%
filter(edad >= 6 & edad <= 12)
nivel_primario <- villa_2124_censo %>%
filter(nivel == 2 & escolaridad == 1)
edad_noasiste <- edad_escolar %>%
filter(escolaridad == 2 | escolaridad == 3) %>%
filter(completo == 2| completo == 0)
repitencia <- nivel_primario %>%
filter(edad > 13 & edad <= 18)
#Escuelas Geo
escuelas <-  read_csv("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/establecimientos-educativos/establecimientos-educativos.csv") %>% st_as_sf(coords = c("long", "lat"), crs = 4326)
primarios <- escuelas %>%
filter(nivmod == "PriCom") %>%
mutate(cueanexo = as.numeric(as.character(cueanexo)))
#Escuelas vacantes
vacantes17 <- read_csv2("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/inscripcion-escolar/preinscripciones-escolares-2017.csv", locale = locale(encoding = "latin1") ) %>%
filter(NIVEL == "PRIMARIO") %>%
group_by(ESTABLECIMIENTO, CUE_ANEXO) %>%
summarise(primero_17 = n())
vacantes16 <- read_csv2("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/inscripcion-escolar/inscripciones-escolares-2016.csv", locale = locale(encoding = "UTF-8") )%>%
filter(NIVEL == "PRIMARIO") %>%
group_by(ESTABLECIMIENTO) %>%
summarise(primero_16 = n())
vacantes_prom <- vacantes17 %>%
bind_cols(., vacantes16) %>%
select(-ESTABLECIMIENTO1) %>%
mutate(total = round((primero_17+primero_16)/2*7,0)) %>%
ungroup() %>%
select(-primero_17, -primero_16, -ESTABLECIMIENTO)
primarios_vacantes <- primarios %>%
left_join(vacantes_prom, by = c("cueanexo" = "CUE_ANEXO")) %>%
select(cueanexo, dom_edific, nombre_abrev, de, comunas, total)
primarios_comuna_4 <- primarios_vacantes %>%
mutate(long = st_coordinates(primarios_vacantes)[,1],
lat = st_coordinates(primarios_vacantes)[,2]) %>%
filter(comunas == 4)
mapa_escuelas <- leaflet() %>%
setView(lng =-58.399685,lat = -34.654402, zoom = 13) %>%
addTiles() %>%
addPolygons(data = st_union(comuna4_geo)) %>%
addPolygons(data = st_union(comuna4_villa2124), color = "red") %>%
addMarkers(data = primarios_comuna_4,
lng = primarios_comuna_4$long,
lat = primarios_comuna_4$lat,
label = ~paste0(primarios_comuna_4$NOMBRE_ABR, ": ",as.character(primarios_comuna_4$total)) )
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/mapa_escuelas.html")
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/post-demian/mapa_escuelas.html")
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/demian/mapa_escuelas.html")
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/demian/mapa_escuelas.html")
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/demian/mapa_escuelas.html")
mapa_escuelas
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/demian/mapa_escuelas.html")
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/mapa_escuelas.html")
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/demian/mapa_escuelas.html")
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/demian/mapa_escuelas.html")
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/demian_mapa_escuelas.html")
mapa_escuelas
comuna4_villa2124_buffer<- comuna4_villa2124 %>%
st_buffer(.,0.007)
escuelas_buffer <- leaflet() %>%
setView(lng =-58.399685,lat = -34.654402, zoom = 13) %>%
addTiles() %>%
addPolygons(data = comuna4_villa2124_buffer, color = "green") %>%
addPolygons(data = st_union(comuna4_geo)) %>%
addPolygons(data = st_union(comuna4_villa2124), color = "red") %>%
addMarkers(data = primarios_comuna_4,
lng = primarios_comuna_4$long,
lat = primarios_comuna_4$lat,
label = ~paste0(primarios_comuna_4$NOMBRE_ABR, ": ",as.character(primarios_comuna_4$total)) )
htmlwidgets::saveWidget(escuelas_buffer, file = "../../public/widgets/demian_escuelas_buffer.html")
escuelas_buffer
escuelas_villa <- st_intersects(primarios_vacantes, comuna4_villa2124_buffer, sparse = FALSE)
escuelas_villa <- data.frame(escuelas_villa) %>%
rename(villa = escuelas_villa)
primarias_villa <-cbind(primarios_vacantes, escuelas_villa$villa) %>%
rename(villa = escuelas_villa.villa)
primarias_villa <- primarias_villa %>%
filter(villa == TRUE)
primarias_villa <- primarias_villa %>%
mutate ( distancia = st_distance(primarias_villa, st_centroid(comuna4_villa2124)) ) %>%
select(-cueanexo, -de, -comunas, villa)
primarias_villa %>%
st_set_geometry(NULL) %>%
select(-villa) %>%
kable() %>%
kable_styling(bootstrap_options = "striped", full_width = F)
alrededores <- cuales_radios(comuna4_geo, comuna4_villa2124_buffer)
alrededores_censo <- radio_persona_caba %>%
filter(CO_FRAC_RA %in% alrededores$RADIO_ID)
alrededores_edad_escolar <- alrededores_censo %>%
filter(edad >= 6 & edad <= 12)
key <- "pk.eyJ1IjoiZGVtb24wMiIsImEiOiJjazBhNGFndGUwZnVtM21tZ3p4cDhiaGluIn0.sOhJPJOn1l_VbN0g_gK8AQ"
caminos <- primarias_villa %>%
mutate(lon_salida = st_coordinates(st_centroid(comuna4_villa2124))[1],
lat_salida = st_coordinates(st_centroid(comuna4_villa2124))[2])
caminos <- caminos %>%
mutate(lon_llegada = st_coordinates(caminos)[,1],
lat_llegada = st_coordinates(primarias_villa)[,2]) %>%
st_set_geometry(NULL)
escuelas_arcos <- mapdeck(style = mapdeck_style("streets"),
location = c(-58.399685, -34.654402), zoom = 10, token = key, pitch = 60) %>%
add_arc(data = caminos,
layer_id = "caminos_escuelas",
destination = c("lon_salida", "lat_salida"),
origin  = c("lon_llegada", "lat_llegada")) %>%
add_polygon(data = comuna4_villa2124)
htmlwidgets::saveWidget(escuelas_arcos, file = "../../public/widgets/demian_escuelas_arcos.html")
blogdown:::serve_site()
