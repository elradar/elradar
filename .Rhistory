addPolygons(data = st_union(comuna4_villa2124), color = "red") %>%
addMarkers(data = primarios_comuna_4,
lng = primarios_comuna_4$long,
lat = primarios_comuna_4$lat,
label = ~paste0(primarios_comuna_4$NOMBRE_ABR, ": ",as.character(primarios_comuna_4$total)) )
mapa_escuelas <- leaflet() %>%
setView(lng =-58.399685,lat = -34.654402, zoom = 13) %>%
addTiles() %>%
addPolygons(data = st_union(comuna4_geo)) %>%
addPolygons(data = st_union(comuna4_villa2124), color = "red") %>%
addMarkers(data = primarios_comuna_4,
lng = primarios_comuna_4$long,
lat = primarios_comuna_4$lat,
label = ~paste0(primarios_comuna_4$NOMBRE_ABR, ": ",as.character(primarios_comuna_4$total)) )
mapa_escuelas
comuna4_villa2124_buffer<- comuna4_villa2124 %>%
st_buffer(.,0.007)
escuelas_buffer <- leaflet() %>%
setView(lng =-58.399685,lat = -34.654402, zoom = 13) %>%
addTiles() %>%
addPolygons(data = comuna4_villa2124_buffer, color = "green") %>%
addPolygons(data = st_union(comuna4_geo)) %>%
addPolygons(data = st_union(comuna4_villa2124), color = "red") %>%
addMarkers(data = primarios_comuna_4,
lng = primarios_comuna_4$long,
lat = primarios_comuna_4$lat,
label = ~paste0(primarios_comuna_4$NOMBRE_ABR, ": ",as.character(primarios_comuna_4$total)) )
htmlwidgets::saveWidget(escuelas_buffer, file = "escuelas_buffer.html")
rm(radio_persona_caba)
gc()
escuelas_buffer <- leaflet() %>%
setView(lng =-58.399685,lat = -34.654402, zoom = 13) %>%
addTiles() %>%
addPolygons(data = comuna4_villa2124_buffer, color = "green") %>%
addPolygons(data = st_union(comuna4_geo)) %>%
addPolygons(data = st_union(comuna4_villa2124), color = "red") %>%
addMarkers(data = primarios_comuna_4,
lng = primarios_comuna_4$long,
lat = primarios_comuna_4$lat,
label = ~paste0(primarios_comuna_4$NOMBRE_ABR, ": ",as.character(primarios_comuna_4$total)) )
escuelas_buffer
escuelas_villa <- st_intersects(primarios_vacantes, comuna4_villa2124_buffer, sparse = FALSE)
escuelas_villa <- data.frame(escuelas_villa) %>%
rename(villa = escuelas_villa)
primarias_villa <-cbind(primarios_vacantes, escuelas_villa$villa) %>%
rename(villa = escuelas_villa.villa)
primarias_villa <- primarias_villa %>%
filter(villa == TRUE)
primarias_villa <- primarias_villa %>%
mutate ( distancia = st_distance(primarias_villa, st_centroid(comuna4_villa2124)) ) %>%
select(-CUEANEXO, -DE, -COMUNA, villa)
primarias_villa %>%
st_set_geometry(NULL) %>%
select(-villa) %>%
kable() %>%
kable_styling(bootstrap_options = "striped", full_width = F)
library(kableExtra)
primarias_villa %>%
st_set_geometry(NULL) %>%
select(-villa) %>%
kable() %>%
kable_styling(bootstrap_options = "striped", full_width = F)
alrededores <- cuales_radios(comuna4_geo, comuna4_villa2124_buffer)
alrededores_censo <- radio_persona_caba %>%
filter(CO_FRAC_RA %in% alrededores$RADIO_ID)
install.packages("mapdeck")
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
library(widgetframe)
# Paquetes a utilizar:
library(tidyverse)
library(sf)
library(leaflet)
library(kableExtra)
library(mapdeck)
library(widgetframe)
# Leemos la data del filesystem local
load(file = "../../public/data/radio_persona_caba.rdata")
radio_persona_caba <- radio_persona_caba %>%
filter(IDDPTO == "004") %>%
rename("relacion_jefe" = P01,
"sexo" = P02,
"edad" = P03,
"nacimiento" = P05,
"pais" = P06,
"lee_escribe" = P07,
"usa_comput" = P12,
"escolaridad" = P08,
"nivel" = P09,
"completo" = P10,
"actividad" = CONDACT,
"material_piso" = H05,
"material_techo" = H06,
"revestimientos" = H07)
#creando CO_FRAC_RA, desde las variables DPTO_REF_ID, IDFRAC e IDRADIO, sacandole los ceros de adelante.
radio_persona_caba <- radio_persona_caba %>%
mutate(IDFRAC = as.numeric(IDFRAC),
IDRADIO = as.numeric(IDRADIO)) %>%
unite(CO_FRAC_RA, DPTO_REF_ID, IDFRAC, IDRADIO, sep = "_", remove = FALSE)
#descargo del repositorio de datos abiertos de Ciudad
censo_geo <- st_read ("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/informacion-censal-por-radio/CABA_rc.geojson", quiet = TRUE)
#selecciono la variable que me sirve
censo_geo_radio <- censo_geo %>%
select(CO_FRAC_RA = RADIO_ID)
#lo uno al censo de personas
radio_persona_caba <- radio_persona_caba %>%
left_join(censo_geo_radio, by = "CO_FRAC_RA")
comuna4_geo <- censo_geo%>%
filter(COMUNA == 4) %>%
select(RADIO_ID)
barrios <- st_read("https://elradar.github.io/data/barrios_populares.geojson", quiet = TRUE)
comuna4_villa2124 <- barrios %>%
filter(FNA == "Villa 21-24") %>%
select(FNA)
ggplot()+
geom_sf(data = comuna4_geo, fill = NA, col = "grey40")+
geom_sf(data = comuna4_villa2124, fill = "green")+
labs(title = "Comuna 4. Radios censales y Asentamientos")+
theme_minimal()
barrios_bis <- st_geometry(barrios)
barrios_bis <- barrios_bis + c(0.00055,-0.0004)
barrios_bis_centroides <- st_centroid(barrios_bis)
barrios_bis <- (barrios_bis - barrios_bis_centroides)*0.99 + barrios_bis_centroides
barrios_bis <- st_sf(barrios_bis, crs = 4326)
barrios$geometry <- st_geometry(barrios_bis)
comuna4_villa2124 <- barrios %>%  #filtro por comuna 4
filter(FNA == "Villa 21-24") %>%
select(FNA)
ggplot()+ #graficamos
geom_sf(data = comuna4_geo, fill = NA, col = "grey40")+
geom_sf(data = comuna4_villa2124, fill = "green")+
labs(title = "Comuna 4. Radios censales y Asentamientos")+
theme_minimal()
# función para detectar en qué radios censales está cierto objeto
cuales_radios <- function(x = comuna4_geo, y){
radios <- st_intersects(x, y)
radios <- lengths(radios)>0
cbind(x, radios) %>%
filter(radios == TRUE)
}
radios_villa_2124 <- cuales_radios(comuna4_geo, comuna4_villa2124)
ggplot()+
geom_sf(data = radios_villa_2124, fill = "red")+
geom_sf(data = comuna4_geo, fill = NA)+
geom_sf(data = comuna4_villa2124, fill = "green")+
labs(title = "Comuna 4. Radios censales de la Villa 21-24")+
theme_minimal()
radio_persona_caba$CO_FRAC_RA <- factor(radio_persona_caba$CO_FRAC_RA)
villa_2124_censo <- radio_persona_caba %>%
filter(CO_FRAC_RA %in% radios_villa_2124$RADIO_ID)
edad_escolar <- villa_2124_censo %>%
filter(edad >= 6 & edad <= 12)
nivel_primario <- villa_2124_censo %>%
filter(nivel == 2 & escolaridad == 1)
edad_noasiste <- edad_escolar %>%
filter(escolaridad == 2 | escolaridad == 3) %>%
filter(completo == 2| completo == 0)
repitencia <- nivel_primario %>%
filter(edad > 13 & edad <= 18)
#Escuelas Geo
escuelas <-  read_csv("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/establecimientos-educativos/establecimientos-educativos.csv") %>% st_as_sf(coords = c("long", "lat"), crs = 4326)
primarios <- escuelas %>%
filter(nivmod == "PriCom") %>%
mutate(cueanexo = as.numeric(as.character(cueanexo)))
#Escuelas vacantes
vacantes17 <- read_csv2("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/inscripcion-escolar/preinscripciones-escolares-2017.csv", locale = locale(encoding = "latin1") ) %>%
filter(NIVEL == "PRIMARIO") %>%
group_by(ESTABLECIMIENTO, CUE_ANEXO) %>%
summarise(primero_17 = n())
vacantes16 <- read_csv2("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/inscripcion-escolar/inscripciones-escolares-2016.csv", locale = locale(encoding = "UTF-8") )%>%
filter(NIVEL == "PRIMARIO") %>%
group_by(ESTABLECIMIENTO) %>%
summarise(primero_16 = n())
vacantes_prom <- vacantes17 %>%
bind_cols(., vacantes16) %>%
select(-ESTABLECIMIENTO1) %>%
mutate(total = round((primero_17+primero_16)/2*7,0)) %>%
ungroup() %>%
select(-primero_17, -primero_16, -ESTABLECIMIENTO)
primarios_vacantes <- primarios %>%
left_join(vacantes_prom, by = c("cueanexo" = "CUE_ANEXO")) %>%
select(cueanexo, dom_edific, nombre_abrev, de, comunas, total)
primarios_comuna_4 <- primarios_vacantes %>%
mutate(long = st_coordinates(primarios_vacantes)[,1],
lat = st_coordinates(primarios_vacantes)[,2]) %>%
filter(comunas == 4)
mapa_escuelas <- leaflet() %>%
setView(lng =-58.399685,lat = -34.654402, zoom = 13) %>%
addTiles() %>%
addPolygons(data = st_union(comuna4_geo)) %>%
addPolygons(data = st_union(comuna4_villa2124), color = "red") %>%
addMarkers(data = primarios_comuna_4,
lng = primarios_comuna_4$long,
lat = primarios_comuna_4$lat,
label = ~paste0(primarios_comuna_4$NOMBRE_ABR, ": ",as.character(primarios_comuna_4$total)) )
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/mapa_escuelas.html")
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/post-demian/mapa_escuelas.html")
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/demian/mapa_escuelas.html")
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/demian/mapa_escuelas.html")
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/demian/mapa_escuelas.html")
mapa_escuelas
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/demian/mapa_escuelas.html")
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/mapa_escuelas.html")
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/demian/mapa_escuelas.html")
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/demian/mapa_escuelas.html")
htmlwidgets::saveWidget(mapa_escuelas, file = "../../public/widgets/demian_mapa_escuelas.html")
mapa_escuelas
comuna4_villa2124_buffer<- comuna4_villa2124 %>%
st_buffer(.,0.007)
escuelas_buffer <- leaflet() %>%
setView(lng =-58.399685,lat = -34.654402, zoom = 13) %>%
addTiles() %>%
addPolygons(data = comuna4_villa2124_buffer, color = "green") %>%
addPolygons(data = st_union(comuna4_geo)) %>%
addPolygons(data = st_union(comuna4_villa2124), color = "red") %>%
addMarkers(data = primarios_comuna_4,
lng = primarios_comuna_4$long,
lat = primarios_comuna_4$lat,
label = ~paste0(primarios_comuna_4$NOMBRE_ABR, ": ",as.character(primarios_comuna_4$total)) )
htmlwidgets::saveWidget(escuelas_buffer, file = "../../public/widgets/demian_escuelas_buffer.html")
escuelas_buffer
escuelas_villa <- st_intersects(primarios_vacantes, comuna4_villa2124_buffer, sparse = FALSE)
escuelas_villa <- data.frame(escuelas_villa) %>%
rename(villa = escuelas_villa)
primarias_villa <-cbind(primarios_vacantes, escuelas_villa$villa) %>%
rename(villa = escuelas_villa.villa)
primarias_villa <- primarias_villa %>%
filter(villa == TRUE)
primarias_villa <- primarias_villa %>%
mutate ( distancia = st_distance(primarias_villa, st_centroid(comuna4_villa2124)) ) %>%
select(-cueanexo, -de, -comunas, villa)
primarias_villa %>%
st_set_geometry(NULL) %>%
select(-villa) %>%
kable() %>%
kable_styling(bootstrap_options = "striped", full_width = F)
alrededores <- cuales_radios(comuna4_geo, comuna4_villa2124_buffer)
alrededores_censo <- radio_persona_caba %>%
filter(CO_FRAC_RA %in% alrededores$RADIO_ID)
alrededores_edad_escolar <- alrededores_censo %>%
filter(edad >= 6 & edad <= 12)
key <- "pk.eyJ1IjoiZGVtb24wMiIsImEiOiJjazBhNGFndGUwZnVtM21tZ3p4cDhiaGluIn0.sOhJPJOn1l_VbN0g_gK8AQ"
caminos <- primarias_villa %>%
mutate(lon_salida = st_coordinates(st_centroid(comuna4_villa2124))[1],
lat_salida = st_coordinates(st_centroid(comuna4_villa2124))[2])
caminos <- caminos %>%
mutate(lon_llegada = st_coordinates(caminos)[,1],
lat_llegada = st_coordinates(primarias_villa)[,2]) %>%
st_set_geometry(NULL)
escuelas_arcos <- mapdeck(style = mapdeck_style("streets"),
location = c(-58.399685, -34.654402), zoom = 10, token = key, pitch = 60) %>%
add_arc(data = caminos,
layer_id = "caminos_escuelas",
destination = c("lon_salida", "lat_salida"),
origin  = c("lon_llegada", "lat_llegada")) %>%
add_polygon(data = comuna4_villa2124)
htmlwidgets::saveWidget(escuelas_arcos, file = "../../public/widgets/demian_escuelas_arcos.html")
blogdown:::serve_site()
library(tidyverse)
library(sf)
library(leaflet)
library(osrm)
filter(ruteo_centrico, distance == min(distance))$DESTINO
library(tidyverse)
library(sf)
library(leaflet)
library(osrm)
barrios <- st_read("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/barrios/barrios.geojson")
hospitales <- read.csv("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/hospitales/hospitales.csv",
encoding="UTF-8") %>%
mutate(nombre=as.character(nombre))
barrios_centroides <- barrios %>%
st_centroid() %>%
filter(barrio=="PALERMO" | barrio=="VILLA LUGANO") %>%
mutate(ubicacion=if_else(barrio=="PALERMO", "CENTRO", "PERIFERIA"))
barrios_centroides <- cbind(barrios_centroides, st_coordinates(barrios_centroides)) %>%
st_set_geometry(NULL) %>%
rename(LON_ORIGEN=X,
LAT_ORIGEN=Y)
hospitales %>%
group_by(barrio) %>%
summarise(cantidad=n()) %>%
mutate(barrio=toupper(barrio)) %>%
left_join(barrios, by="barrio") %>%
ungroup() %>%
ggplot()+
geom_sf(data=barrios, fill="gray90", color="white")+
geom_sf(aes(fill=cantidad, geometry = geometry), color="white")+
geom_point(data=barrios_centroides, aes(x=LON_ORIGEN, y=LAT_ORIGEN, color=ubicacion), shape=4, stroke=2, size=2)+
geom_point(data=hospitales, aes(x=long, y=lat), size=1.5)+
scale_fill_gradient(low="gold", high= "deeppink4")+
scale_color_manual(values = c("turquoise4", "magenta4"))+
labs(title = "Hospitales públicos por barrio",
fill="",
color="",
x="",
y="",
caption= "Fuente: Elaboración propia en base a datos de BAData")+
theme(panel.background = element_rect(fill = "gray100", colour = "gray100", size = 2, linetype = "solid"),
panel.grid.major = element_line(size = 0.5, linetype = "dashed", colour = "gray80"),
title=element_text(size=10, face = "bold"), plot.title = element_text(hjust = 0.5),
legend.key.size = unit(0.6, "cm"), legend.key.width = unit(0.5,"cm"),
legend.text=element_text(size=7),
plot.caption=element_text(face = "italic", colour = "gray35",size=6),
axis.text = element_blank(), axis.ticks = element_blank())
ruteo_hospitales <- function(o_nombre, o_x, o_y, d_nombre, d_x, d_y) {
ruta <- osrmRoute(src = c(o_nombre, o_x, o_y),
dst = c(d_nombre, d_x, d_y),
returnclass = "sf",
overview = "full")
cbind(ORIGEN = o_nombre, DESTINO = d_nombre, ruta)
}
h_palermo <- hospitales %>%
mutate(NOMBRE_ORIGEN="PALERMO") %>%
left_join(barrios_centroides, by=c("NOMBRE_ORIGEN"="barrio")) %>%
rename(NOMBRE_DESTINO=nombre,
LON_DESTINO=long,
LAT_DESTINO=lat) %>%
select(NOMBRE_ORIGEN, LON_ORIGEN, LAT_ORIGEN, NOMBRE_DESTINO, LON_DESTINO, LAT_DESTINO)
head(h_palermo)
ruteo_palermo <- list(h_palermo$NOMBRE_ORIGEN, h_palermo$LON_ORIGEN,h_palermo$LAT_ORIGEN,
h_palermo$NOMBRE_DESTINO, h_palermo$LON_DESTINO,h_palermo$LAT_DESTINO)
ruteo_centrico <- pmap(ruteo_palermo, ruteo_hospitales) %>%
reduce(rbind)
ruteo_centrico
View(ruteo_centrico)
blogdown:::serve_site()
library(tidyverse)
library(sf)
library(leaflet)
library(osrm)
barrios <- st_read("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/barrios/barrios.geojson")
hospitales <- read.csv("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/hospitales/hospitales.csv",
encoding="UTF-8") %>%
mutate(nombre=as.character(nombre))
barrios_centroides <- barrios %>%
st_centroid() %>%
filter(barrio=="PALERMO" | barrio=="VILLA LUGANO") %>%
mutate(ubicacion=if_else(barrio=="PALERMO", "CENTRO", "PERIFERIA"))
barrios_centroides <- cbind(barrios_centroides, st_coordinates(barrios_centroides)) %>%
st_set_geometry(NULL) %>%
rename(LON_ORIGEN=X,
LAT_ORIGEN=Y)
hospitales %>%
group_by(barrio) %>%
summarise(cantidad=n()) %>%
mutate(barrio=toupper(barrio)) %>%
left_join(barrios, by="barrio") %>%
ungroup() %>%
ggplot()+
geom_sf(data=barrios, fill="gray90", color="white")+
geom_sf(aes(fill=cantidad, geometry = geometry), color="white")+
geom_point(data=barrios_centroides, aes(x=LON_ORIGEN, y=LAT_ORIGEN, color=ubicacion), shape=4, stroke=2, size=2)+
geom_point(data=hospitales, aes(x=long, y=lat), size=1.5)+
scale_fill_gradient(low="gold", high= "deeppink4")+
scale_color_manual(values = c("turquoise4", "magenta4"))+
labs(title = "Hospitales públicos por barrio",
fill="",
color="",
x="",
y="",
caption= "Fuente: Elaboración propia en base a datos de BAData")+
theme(panel.background = element_rect(fill = "gray100", colour = "gray100", size = 2, linetype = "solid"),
panel.grid.major = element_line(size = 0.5, linetype = "dashed", colour = "gray80"),
title=element_text(size=10, face = "bold"), plot.title = element_text(hjust = 0.5),
legend.key.size = unit(0.6, "cm"), legend.key.width = unit(0.5,"cm"),
legend.text=element_text(size=7),
plot.caption=element_text(face = "italic", colour = "gray35",size=6),
axis.text = element_blank(), axis.ticks = element_blank())
ruteo_hospitales <- function(o_nombre, o_x, o_y, d_nombre, d_x, d_y) {
ruta <- osrmRoute(src = c(o_nombre, o_x, o_y),
dst = c(d_nombre, d_x, d_y),
returnclass = "sf",
overview = "full")
cbind(ORIGEN = o_nombre, DESTINO = d_nombre, ruta)
}
h_palermo <- hospitales %>%
mutate(NOMBRE_ORIGEN="PALERMO") %>%
left_join(barrios_centroides, by=c("NOMBRE_ORIGEN"="barrio")) %>%
rename(NOMBRE_DESTINO=nombre,
LON_DESTINO=long,
LAT_DESTINO=lat) %>%
select(NOMBRE_ORIGEN, LON_ORIGEN, LAT_ORIGEN, NOMBRE_DESTINO, LON_DESTINO, LAT_DESTINO)
head(h_palermo)
ruteo_palermo <- list(h_palermo$NOMBRE_ORIGEN, h_palermo$LON_ORIGEN,h_palermo$LAT_ORIGEN,
h_palermo$NOMBRE_DESTINO, h_palermo$LON_DESTINO,h_palermo$LAT_DESTINO)
ruteo_centrico <- pmap(ruteo_palermo, ruteo_hospitales) %>%
reduce(rbind)
ruteo_centrico %>%
summary()
filter(ruteo_centrico, distance == min(distance))$DESTINO
ruteo_centrico <- ruteo_centrico %>%
arrange(distance) %>%
head(10) %>%
left_join(h_palermo, by=c("DESTINO"="NOMBRE_DESTINO")) %>%
mutate(RUTA = paste("Desde", ORIGEN,"hasta", DESTINO))
ruteo_centrico$DESTINO
paleta <- c(low="gold", high= "deeppink4")
icons_d <- awesomeIcons(icon = "hospital-o",
iconColor = "black",
library = "fa",
markerColor = "red")
icons_o <- awesomeIcons(icon = "whatever",
iconColor = "black",
library = "fa",
markerColor = "gray")
labels <- sprintf(
"<strong>%s</strong><br/>%g km <br/>%g min",
ruteo_centrico$RUTA, round(ruteo_centrico$distance, 2), round(ruteo_centrico$duration, 0)
) %>% lapply(htmltools::HTML)
mapa <- leaflet(ruteo_centrico) %>%
addTiles() %>%
addProviderTiles(providers$CartoDB) %>%
addPolylines(color = ~colorNumeric(paleta, ruteo_centrico$distance)(distance),
weight = 6,
label = labels,
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "2px 5px"),
textsize = "10px",
direction = "top"),
highlight = highlightOptions(weight = 8,
bringToFront = TRUE)) %>%
addLegend("bottomright", pal = colorNumeric(paleta, ruteo_centrico$distance), values = ~distance,
title = "Distancia",
labFormat = labelFormat(suffix = "km"),
opacity = 0.75) %>%
addAwesomeMarkers(~LON_DESTINO, ~LAT_DESTINO, popup = ~DESTINO, icon=icons_d)%>%
addAwesomeMarkers(~LON_ORIGEN, ~LAT_ORIGEN, popup = ~ORIGEN, icon=icons_o)
mapa
ruteo_periferico <- ruteo_periferico %>%
arrange(distance) %>%
head(10) %>%
left_join(h_lugano, by=c("DESTINO"="NOMBRE_DESTINO")) %>%
mutate(RUTA = paste("Desde", ORIGEN,"hasta", DESTINO))
ruteo_lugano <- list(h_lugano$NOMBRE_ORIGEN, h_lugano$LON_ORIGEN,h_lugano$LAT_ORIGEN,
h_lugano$NOMBRE_DESTINO, h_lugano$LON_DESTINO,h_lugano$LAT_DESTINO)
h_lugano <- hospitales %>%
mutate(NOMBRE_ORIGEN="VILLA LUGANO") %>%
left_join(barrios_centroides, by=c("NOMBRE_ORIGEN"="barrio")) %>%
rename(NOMBRE_DESTINO=nombre,
LON_DESTINO=long,
LAT_DESTINO=lat) %>%
select(NOMBRE_ORIGEN, LON_ORIGEN, LAT_ORIGEN, NOMBRE_DESTINO, LON_DESTINO, LAT_DESTINO)
head(h_lugano)
ruteo_lugano <- list(h_lugano$NOMBRE_ORIGEN, h_lugano$LON_ORIGEN,h_lugano$LAT_ORIGEN,
h_lugano$NOMBRE_DESTINO, h_lugano$LON_DESTINO,h_lugano$LAT_DESTINO)
ruteo_periferico <- pmap(ruteo_lugano, ruteo_hospitales) %>%
reduce(rbind)
ruteo_periferico %>%
summary()
filter(ruteo_periferico, distance == min(distance))$DESTINO
ruteo_periferico <- ruteo_periferico %>%
arrange(distance) %>%
head(10) %>%
left_join(h_lugano, by=c("DESTINO"="NOMBRE_DESTINO")) %>%
mutate(RUTA = paste("Desde", ORIGEN,"hasta", DESTINO))
ruteo_periferico$DESTINO
labels <- sprintf(
"<strong>%s</strong><br/>%g km <br/>%g min",
ruteo_periferico$RUTA, round(ruteo_periferico$distance, 2), round(ruteo_periferico$duration, 0)
) %>% lapply(htmltools::HTML)
mapa2 <- leaflet(ruteo_periferico) %>%
addTiles() %>%
addProviderTiles(providers$CartoDB) %>%
addPolylines(color = ~colorNumeric(paleta, ruteo_periferico$distance)(distance),
label = labels,
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "2px 5px"),
textsize = "10px",
direction = "top")) %>%
addLegend("bottomright", pal = colorNumeric(paleta, ruteo_periferico$distance), values = ~distance,
title = "Distancia",
labFormat = labelFormat(suffix = "km"),
opacity = 0.75)%>%
addAwesomeMarkers(~LON_DESTINO, ~LAT_DESTINO, popup = ~DESTINO, icon=icons_d)%>%
addAwesomeMarkers(~LON_ORIGEN, ~LAT_ORIGEN, popup = ~ORIGEN, icon=icons_o)
mapa2
htmlwidgets::saveWidget(mapa, file = "../../public/widgets/angie_mapa_lugano.html")
mapa1 <- leaflet(ruteo_centrico) %>%
addTiles() %>%
addProviderTiles(providers$CartoDB) %>%
addPolylines(color = ~colorNumeric(paleta, ruteo_centrico$distance)(distance),
weight = 6,
label = labels,
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "2px 5px"),
textsize = "10px",
direction = "top"),
highlight = highlightOptions(weight = 8,
bringToFront = TRUE)) %>%
addLegend("bottomright", pal = colorNumeric(paleta, ruteo_centrico$distance), values = ~distance,
title = "Distancia",
labFormat = labelFormat(suffix = "km"),
opacity = 0.75) %>%
addAwesomeMarkers(~LON_DESTINO, ~LAT_DESTINO, popup = ~DESTINO, icon=icons_d)%>%
addAwesomeMarkers(~LON_ORIGEN, ~LAT_ORIGEN, popup = ~ORIGEN, icon=icons_o)
htmlwidgets::saveWidget(mapa1, file = "../../public/widgets/angie_mapa_palermo.html")
mapa2 <- leaflet(ruteo_periferico) %>%
addTiles() %>%
addProviderTiles(providers$CartoDB) %>%
addPolylines(color = ~colorNumeric(paleta, ruteo_periferico$distance)(distance),
label = labels,
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "2px 5px"),
textsize = "10px",
direction = "top")) %>%
addLegend("bottomright", pal = colorNumeric(paleta, ruteo_periferico$distance), values = ~distance,
title = "Distancia",
labFormat = labelFormat(suffix = "km"),
opacity = 0.75)%>%
addAwesomeMarkers(~LON_DESTINO, ~LAT_DESTINO, popup = ~DESTINO, icon=icons_d)%>%
addAwesomeMarkers(~LON_ORIGEN, ~LAT_ORIGEN, popup = ~ORIGEN, icon=icons_o)
htmlwidgets::saveWidget(mapa2, file = "../../public/widgets/angie_mapa_lugano.html")
